{# templates/partials/_right_drawer.html #}
<!-- Backdrop -->
<div id="drawerBackdrop"
     class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-40"
     onclick="window.closeDrawer()"></div>

<!-- Right Drawer -->
<aside id="rightDrawer"
       dir="rtl"
       class="fixed top-0 right-0 h-full w-[86%] max-w-sm translate-x-full z-50
              bg-white dark:bg-neutral-900 border-l border-neutral-200 dark:border-neutral-800
              shadow-xl transition-transform duration-300 will-change-transform">
  <div class="flex items-center justify-between px-4 py-3 border-b dark:border-neutral-800">
    <h3 class="text-sm font-bold">منو</h3>
    <button class="w-9 h-9 inline-flex items-center justify-center rounded-lg border border-neutral-200 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800"
            aria-label="بستن"
            onclick="window.closeDrawer()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <nav class="p-3 space-y-2 text-sm">
    <a href="/" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">داشبورد</a>
    <a href="/prefs" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">ترجیحات</a>
    <a href="/settings" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">تنظیمات سیگنال</a>

    <!-- Dropdown: بازارها -->
    <details class="group rounded-lg border border-neutral-200 dark:border-neutral-800">
      <summary class="cursor-pointer px-3 py-2 rounded-lg list-none flex items-center justify-between">
        <span>بازارها</span>
        <svg class="w-4 h-4 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </summary>
      <div class="p-2 pt-0 space-y-1">
        <a href="/?s=BTC" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">BTC/USDT</a>
        <a href="/?s=ETH" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">ETH/USDT</a>
        <a href="/?s=BNB" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">BNB/USDT</a>
      </div>
    </details>

    <!-- Dropdown: گزارش‌ها -->
    <details class="group rounded-lg border border-neutral-200 dark:border-neutral-800">
      <summary class="cursor-pointer px-3 py-2 rounded-lg list-none flex items-center justify-between">
        <span>گزارش‌ها</span>
        <svg class="w-4 h-4 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </summary>
      <div class="p-2 pt-0 space-y-1">
        <a href="/signals/BTC/csv" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">CSV سیگنال‌های BTC</a>
        <a href="/signals/ETH/csv" class="block px-3 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800">CSV سیگنال‌های ETH</a>
      </div>
    </details>
  </nav>
</aside>

<script>
(function () {
  const drawer   = document.getElementById('rightDrawer');
  const backdrop = document.getElementById('drawerBackdrop');

  function openDrawer() {
    drawer.classList.remove('translate-x-full');
    backdrop.classList.remove('hidden');
    // قفل اسکرول بدنه
    document.documentElement.style.overflow = 'hidden';
  }
  function closeDrawer() {
    drawer.classList.add('translate-x-full');
    backdrop.classList.add('hidden');
    document.documentElement.style.overflow = '';
  }

  // ESC برای بستن
  function onKey(e) { if (e.key === 'Escape') closeDrawer(); }

  // اکسپورت به ویندوزگلوبال
  window.openDrawer  = openDrawer;
  window.closeDrawer = closeDrawer;

  // رویدادها
  window.addEventListener('keydown', onKey);
})();
</script>
