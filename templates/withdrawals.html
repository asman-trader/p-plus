{% extends "base.html" %}

{% block title %}برداشت‌ها - داشبورد{% endblock %}

{% block content %}
<div class="card" id="withdraw">
  <h2>برداشت</h2>
  <div class="totals">
    <div class="pill">برداشت کل (USD): <strong>{{ '%.2f' % total_withdraw_usd }}</strong> $</div>
    <div class="pill">برداشت کل (تومان): <strong>{{ '{:,.0f}'.format(total_withdraw_toman) }}</strong></div>
    <div class="pill">برداشت BTC: <strong>{{ '%.8f' % total_withdraw_btc }}</strong> BTC</div>
  </div>
  <form method="post" action="{{ url_for('panel_bp.panel_withdraw') }}" style="margin-top:12px;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="form-grid">
      <label>
        مقدار BTC برداشت
        <input type="number" step="0.00000001" min="0" name="amount_btc" required inputmode="decimal" placeholder="مثلاً 0.003">
      </label>
      <label>
        قیمت دلار هر BTC (لحظه برداشت)
        <input type="number" step="0.01" min="0" name="price_usd_per_btc" required inputmode="decimal" placeholder="مثلاً 60000">
      </label>
    </div>
    <div style="margin-top:12px; display:flex; gap:10px;">
      <button type="submit" class="btn btn-danger">ثبت برداشت</button>
    </div>
  </form>
</div>

<div class="card" id="withdrawals-list">
  <h2>لیست برداشت‌ها</h2>
  <div class="table-scroll">
    <table class="responsive">
      <thead>
        <tr>
          <th>#</th>
          <th>تاریخ</th>
          <th>BTC</th>
          <th>قیمت واحد (USD)</th>
          <th>مبلغ (USD)</th>
        </tr>
      </thead>
      <tbody>
        {% if withdrawals %}
          {% for w in withdrawals %}
            <tr>
              <td data-label="#">{{ w["id"] }}</td>
              <td class="muted" data-label="تاریخ">{{ w["created_at"] }}</td>
              <td data-label="BTC">{{ '%.8f' % w["amount_btc"] }}</td>
              <td data-label="قیمت واحد (USD)">{{ '%.2f' % w["price_usd_per_btc"] }}</td>
              <td data-label="مبلغ (USD)">{{ '%.2f' % (w["amount_btc"] * w["price_usd_per_btc"]) }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="5" class="muted">برداشتی ثبت نشده است.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
