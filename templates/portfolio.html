{% extends "base.html" %}

{% block content %}
<style>
  /* Portfolio Management Styles */
  .portfolio-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }
  
  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px 30px;
    border-radius: 20px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
  }
  
  .page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="portfolioPattern" width="50" height="50" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="2" fill="white" opacity="0.1"/><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="40" cy="40" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23portfolioPattern)"/></svg>');
    opacity: 0.3;
  }
  
  .page-content {
    position: relative;
    z-index: 1;
  }
  
  .page-title {
    font-size: 36px;
    font-weight: 800;
    margin: 0 0 8px 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .page-subtitle {
    font-size: 18px;
    margin: 0;
    opacity: 0.9;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 30px;
  }
  
  .stat-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 16px;
    padding: 24px;
    text-align: center;
    transition: all 0.3s ease;
  }
  
  .stat-card:hover {
    transform: translateY(-4px);
    background: rgba(255, 255, 255, 0.2);
  }
  
  .stat-value {
    font-size: 32px;
    font-weight: 800;
    margin: 0 0 8px 0;
  }
  
  .stat-label {
    font-size: 14px;
    opacity: 0.8;
    margin: 0;
  }
  
  .section {
    background: var(--card);
    border: 1px solid var(--card-border);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
  }
  
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid var(--card-border);
  }
  
  .section-title {
    font-size: 24px;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .section-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
  }
  
  .add-button {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .add-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
  }
  
  .wallets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .wallet-card {
    background: var(--card);
    border: 2px solid var(--card-border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .wallet-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.1);
    border-color: var(--primary);
  }
  
  .wallet-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--wallet-color, #3b82f6);
  }
  
  .wallet-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
  }
  
  .wallet-name {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
    color: var(--text);
  }
  
  .wallet-type {
    background: var(--pill-bg);
    color: var(--muted);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }
  
  .wallet-description {
    color: var(--muted);
    font-size: 14px;
    margin: 0 0 16px 0;
    line-height: 1.5;
  }
  
  .wallet-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }
  
  .wallet-stat {
    text-align: center;
  }
  
  .wallet-stat-value {
    font-size: 18px;
    font-weight: 700;
    margin: 0 0 4px 0;
    color: var(--text);
  }
  
  .wallet-stat-label {
    font-size: 12px;
    color: var(--muted);
    margin: 0;
  }
  
  .goals-list {
    display: grid;
    gap: 16px;
  }
  
  .goal-item {
    background: var(--pill-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
  }
  
  .goal-item:hover {
    background: var(--card);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  .goal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  
  .goal-name {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    color: var(--text);
  }
  
  .goal-type {
    background: var(--primary);
    color: white;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
  }
  
  .goal-progress {
    margin-bottom: 12px;
  }
  
  .goal-progress-bar {
    width: 100%;
    height: 8px;
    background: var(--card-border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
  }
  
  .goal-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981, #059669);
    border-radius: 4px;
    transition: width 0.3s ease;
  }
  
  .goal-progress-text {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--muted);
  }
  
  .risk-limits-list {
    display: grid;
    gap: 16px;
  }
  
  .risk-item {
    background: var(--pill-bg);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
  }
  
  .risk-item:hover {
    background: var(--card);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  .risk-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  
  .risk-type {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
    color: var(--text);
  }
  
  .risk-status {
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
  }
  
  .risk-status.active {
    background: #10b981;
    color: white;
  }
  
  .risk-status.inactive {
    background: var(--muted);
    color: white;
  }
  
  .risk-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin: 0;
  }
  
  .risk-threshold {
    font-size: 12px;
    color: var(--muted);
    margin: 4px 0 0 0;
  }
  
  .form-container {
    background: var(--card);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
  }
  
  .form-title {
    font-size: 20px;
    font-weight: 700;
    margin: 0 0 24px 0;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
  }
  
  .form-label {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 8px;
  }
  
  .form-input, .form-select, .form-textarea {
    padding: 12px 16px;
    border: 2px solid var(--card-border);
    border-radius: 12px;
    font-size: 14px;
    background: var(--bg);
    color: var(--text);
    transition: all 0.3s ease;
  }
  
  .form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  .form-textarea {
    resize: vertical;
    min-height: 80px;
  }
  
  .form-button {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .form-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
  }
  
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }
  
  .empty-state-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }
  
  .empty-state-title {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: var(--text);
  }
  
  .empty-state-text {
    font-size: 14px;
    margin: 0;
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .portfolio-container {
      padding: 16px;
    }
    
    .page-header {
      padding: 24px 20px;
    }
    
    .page-title {
      font-size: 28px;
    }
    
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
    
    .wallets-grid {
      grid-template-columns: 1fr;
    }
    
    .form-grid {
      grid-template-columns: 1fr;
    }
    
    .section {
      padding: 20px;
    }
  }
</style>

<div class="portfolio-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-content">
      <h1 class="page-title">ğŸ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ</h1>
      <p class="page-subtitle">Ù…Ø¯ÛŒØ±ÛŒØª Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§ØŒ Ø§Ù‡Ø¯Ø§Ù Ùˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ³Ú©</p>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value">{{ wallets|length }}</div>
          <div class="stat-label">Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ goals|length }}</div>
          <div class="stat-label">Ø§Ù‡Ø¯Ø§Ù ÙØ¹Ø§Ù„</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">{{ risk_limits|length }}</div>
          <div class="stat-label">Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÛŒØ³Ú©</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${{ '{:,.0f}'.format(sum(wallet_balances.values() | map(attribute='invested_usd') | list)) }}</div>
          <div class="stat-label">Ú©Ù„ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Wallets Section -->
  <div class="section">
    <div class="section-header">
      <h2 class="section-title">
        <div class="section-icon">ğŸ’¼</div>
        Ú©ÛŒÙ Ù¾ÙˆÙ„â€ŒÙ‡Ø§
      </h2>
      <button class="add-button" onclick="toggleForm('walletForm')">
        â• Ø§ÙØ²ÙˆØ¯Ù† Ú©ÛŒÙ Ù¾ÙˆÙ„
      </button>
    </div>
    
    {% if wallets %}
      <div class="wallets-grid">
        {% for wallet in wallets %}
          <div class="wallet-card" style="--wallet-color: {{ wallet.color }}">
            <div class="wallet-header">
              <h3 class="wallet-name">{{ wallet.name }}</h3>
              <span class="wallet-type">{{ wallet.wallet_type }}</span>
            </div>
            <p class="wallet-description">{{ wallet.description or 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª' }}</p>
            <div class="wallet-stats">
              <div class="wallet-stat">
                <div class="wallet-stat-value">{{ '{:.8f}'.format(wallet_balances[wallet.id].btc_balance) }}</div>
                <div class="wallet-stat-label">BTC</div>
              </div>
              <div class="wallet-stat">
                <div class="wallet-stat-value">${{ '{:,.0f}'.format(wallet_balances[wallet.id].invested_usd) }}</div>
                <div class="wallet-stat-label">USD</div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ’¼</div>
        <h3 class="empty-state-title">Ù‡ÛŒÚ† Ú©ÛŒÙ Ù¾ÙˆÙ„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</h3>
        <p class="empty-state-text">Ø§ÙˆÙ„ÛŒÙ† Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯</p>
      </div>
    {% endif %}
  </div>

  <!-- Create Wallet Form -->
  <div class="form-container" id="walletForm" style="display: none;">
    <h3 class="form-title">â• Ø§ÛŒØ¬Ø§Ø¯ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¬Ø¯ÛŒØ¯</h3>
    <form method="post" action="{{ url_for('panel_bp.panel_create_wallet') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="name">Ù†Ø§Ù… Ú©ÛŒÙ Ù¾ÙˆÙ„ *</label>
          <input type="text" id="name" name="name" class="form-input" required placeholder="Ù…Ø«Ù„Ø§Ù‹ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø§ØµÙ„ÛŒ">
        </div>
        
        <div class="form-group">
          <label class="form-label" for="wallet_type">Ù†ÙˆØ¹ Ú©ÛŒÙ Ù¾ÙˆÙ„</label>
          <select id="wallet_type" name="wallet_type" class="form-select">
            <option value="main">Ø§ØµÙ„ÛŒ</option>
            <option value="trading">Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ</option>
            <option value="savings">Ù¾Ø³â€ŒØ§Ù†Ø¯Ø§Ø²</option>
            <option value="dca">Ø®Ø±ÛŒØ¯ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ</option>
            <option value="arbitrage">Ø¢Ø±Ø¨ÛŒØªØ±Ø§Ú˜</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="color">Ø±Ù†Ú¯</label>
          <input type="color" id="color" name="color" class="form-input" value="#3b82f6">
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label" for="description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <textarea id="description" name="description" class="form-textarea" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ..."></textarea>
      </div>
      
      <button type="submit" class="form-button">
        ğŸ’¼ Ø§ÛŒØ¬Ø§Ø¯ Ú©ÛŒÙ Ù¾ÙˆÙ„
      </button>
    </form>
  </div>

  <!-- Goals Section -->
  <div class="section">
    <div class="section-header">
      <h2 class="section-title">
        <div class="section-icon">ğŸ¯</div>
        Ø§Ù‡Ø¯Ø§Ù Ù¾ÙˆØ±ØªÙÙˆÙ„ÛŒÙˆ
      </h2>
      <button class="add-button" onclick="toggleForm('goalForm')">
        â• Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ø¯Ù
      </button>
    </div>
    
    {% if goals %}
      <div class="goals-list">
        {% for goal in goals %}
          <div class="goal-item">
            <div class="goal-header">
              <h3 class="goal-name">{{ goal.goal_name }}</h3>
              <span class="goal-type">{{ goal.goal_type }}</span>
            </div>
            <div class="goal-progress">
              <div class="goal-progress-bar">
                <div class="goal-progress-fill" style="width: {{ (goal.current_value / goal.target_value * 100) if goal.target_value > 0 else 0 }}%"></div>
              </div>
              <div class="goal-progress-text">
                <span>${{ '{:,.0f}'.format(goal.current_value) }}</span>
                <span>${{ '{:,.0f}'.format(goal.target_value) }}</span>
              </div>
            </div>
            <p style="margin: 8px 0 0 0; font-size: 12px; color: var(--muted);">
              Ú©ÛŒÙ Ù¾ÙˆÙ„: {{ goal.wallet_name }}
              {% if goal.target_date %}
                | ØªØ§Ø±ÛŒØ® Ù‡Ø¯Ù: {{ goal.target_date }}
              {% endif %}
            </p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ¯</div>
        <h3 class="empty-state-title">Ù‡ÛŒÚ† Ù‡Ø¯ÙÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡</h3>
        <p class="empty-state-text">Ø§ÙˆÙ„ÛŒÙ† Ù‡Ø¯Ù Ø®ÙˆØ¯ Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯</p>
      </div>
    {% endif %}
  </div>

  <!-- Create Goal Form -->
  <div class="form-container" id="goalForm" style="display: none;">
    <h3 class="form-title">ğŸ¯ ØªØ¹Ø±ÛŒÙ Ù‡Ø¯Ù Ø¬Ø¯ÛŒØ¯</h3>
    <form method="post" action="{{ url_for('panel_bp.panel_create_goal') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="goal_name">Ù†Ø§Ù… Ù‡Ø¯Ù *</label>
          <input type="text" id="goal_name" name="goal_name" class="form-input" required placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ 1 BTC">
        </div>
        
        <div class="form-group">
          <label class="form-label" for="wallet_id">Ú©ÛŒÙ Ù¾ÙˆÙ„</label>
          <select id="wallet_id" name="wallet_id" class="form-select" required>
            {% for wallet in wallets %}
              <option value="{{ wallet.id }}">{{ wallet.name }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="goal_type">Ù†ÙˆØ¹ Ù‡Ø¯Ù</label>
          <select id="goal_type" name="goal_type" class="form-select">
            <option value="value">Ø§Ø±Ø²Ø´ Ø¯Ù„Ø§Ø±ÛŒ</option>
            <option value="btc">Ù…Ù‚Ø¯Ø§Ø± BTC</option>
            <option value="roi">Ø¨Ø§Ø²Ø¯Ù‡ÛŒ Ø¯Ø±ØµØ¯ÛŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="target_value">Ù…Ù‚Ø¯Ø§Ø± Ù‡Ø¯Ù *</label>
          <input type="number" id="target_value" name="target_value" class="form-input" required step="0.01" min="0" placeholder="100000">
        </div>
        
        <div class="form-group">
          <label class="form-label" for="target_date">ØªØ§Ø±ÛŒØ® Ù‡Ø¯Ù</label>
          <input type="date" id="target_date" name="target_date" class="form-input">
        </div>
      </div>
      
      <button type="submit" class="form-button">
        ğŸ¯ ØªØ¹Ø±ÛŒÙ Ù‡Ø¯Ù
      </button>
    </form>
  </div>

  <!-- Risk Limits Section -->
  <div class="section">
    <div class="section-header">
      <h2 class="section-title">
        <div class="section-icon">âš ï¸</div>
        Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ³Ú©
      </h2>
      <button class="add-button" onclick="toggleForm('riskForm')">
        â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
      </button>
    </div>
    
    {% if risk_limits %}
      <div class="risk-limits-list">
        {% for limit in risk_limits %}
          <div class="risk-item">
            <div class="risk-header">
              <h3 class="risk-type">{{ limit.limit_type }}</h3>
              <span class="risk-status {{ 'active' if limit.is_active else 'inactive' }}">
                {{ 'ÙØ¹Ø§Ù„' if limit.is_active else 'ØºÛŒØ±ÙØ¹Ø§Ù„' }}
              </span>
            </div>
            <div class="risk-value">${{ '{:,.0f}'.format(limit.limit_value) }}</div>
            <p class="risk-threshold">
              Ù‡Ø´Ø¯Ø§Ø± Ø¯Ø±: ${{ '{:,.0f}'.format(limit.limit_value * limit.alert_threshold) }}
              | Ú©ÛŒÙ Ù¾ÙˆÙ„: {{ limit.wallet_name }}
            </p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-state-icon">âš ï¸</div>
        <h3 class="empty-state-title">Ù‡ÛŒÚ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÛŒØ³Ú©ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡</h3>
        <p class="empty-state-text">Ø§ÙˆÙ„ÛŒÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÛŒØ³Ú© Ø®ÙˆØ¯ Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ú©Ù†ÛŒØ¯</p>
      </div>
    {% endif %}
  </div>

  <!-- Create Risk Limit Form -->
  <div class="form-container" id="riskForm" style="display: none;">
    <h3 class="form-title">âš ï¸ ØªØ¹Ø±ÛŒÙ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø±ÛŒØ³Ú©</h3>
    <form method="post" action="{{ url_for('panel_bp.panel_create_risk_limit') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="limit_type">Ù†ÙˆØ¹ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª</label>
          <select id="limit_type" name="limit_type" class="form-select">
            <option value="max_loss">Ø­Ø¯Ø§Ú©Ø«Ø± Ø¶Ø±Ø±</option>
            <option value="max_investment">Ø­Ø¯Ø§Ú©Ø«Ø± Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</option>
            <option value="daily_loss">Ø¶Ø±Ø± Ø±ÙˆØ²Ø§Ù†Ù‡</option>
            <option value="position_size">Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="wallet_id">Ú©ÛŒÙ Ù¾ÙˆÙ„</label>
          <select id="wallet_id" name="wallet_id" class="form-select" required>
            {% for wallet in wallets %}
              <option value="{{ wallet.id }}">{{ wallet.name }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="limit_value">Ù…Ù‚Ø¯Ø§Ø± Ù…Ø­Ø¯ÙˆØ¯ÛŒØª *</label>
          <input type="number" id="limit_value" name="limit_value" class="form-input" required step="0.01" min="0" placeholder="10000">
        </div>
        
        <div class="form-group">
          <label class="form-label" for="alert_threshold">Ø¢Ø³ØªØ§Ù†Ù‡ Ù‡Ø´Ø¯Ø§Ø± (0-1)</label>
          <input type="number" id="alert_threshold" name="alert_threshold" class="form-input" step="0.1" min="0" max="1" value="0.8" placeholder="0.8">
        </div>
      </div>
      
      <button type="submit" class="form-button">
        âš ï¸ ØªØ¹Ø±ÛŒÙ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
      </button>
    </form>
  </div>
</div>

<script>
function toggleForm(formId) {
  const form = document.getElementById(formId);
  if (form.style.display === 'none') {
    form.style.display = 'block';
    form.scrollIntoView({ behavior: 'smooth' });
  } else {
    form.style.display = 'none';
  }
}

// Auto-hide forms after submission
document.addEventListener('DOMContentLoaded', function() {
  const forms = document.querySelectorAll('form');
  forms.forEach(form => {
    form.addEventListener('submit', function() {
      setTimeout(() => {
        const formContainer = form.closest('.form-container');
        if (formContainer) {
          formContainer.style.display = 'none';
        }
      }, 1000);
    });
  });
});
</script>
{% endblock %}
