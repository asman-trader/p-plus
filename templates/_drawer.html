{% macro drawer() %}
  <style>
    .drawer-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:opacity .25s ease;z-index:999}
    .drawer-backdrop.open{opacity:1;pointer-events:auto}
    .drawer{position:fixed;top:0;bottom:0;right:0;width:320px;max-width:88vw;background:var(--card);border-inline-start:1px solid var(--card-border);box-shadow:var(--shadow);transform:translateX(100%);transition:transform .25s ease;z-index:1000;display:flex;flex-direction:column;will-change:transform}
    .drawer.open{transform:translateX(0)}
    .drawer-header{padding:16px;border-bottom:1px solid var(--card-border);display:flex;align-items:center;gap:12px}
    .drawer-header .title{font-weight:800;letter-spacing:.2px}
    .drawer-nav{display:flex;flex-direction:column;padding:8px}
    .drawer-nav a{display:flex;align-items:center;gap:12px;padding:12px 14px;text-decoration:none;color:var(--text);border-radius:12px;transition:background .2s ease,transform .2s ease}
    .drawer-nav a:hover{background:var(--pill-bg);transform:translateX(-2px)}
    .drawer-nav a[aria-current="page"]{background:var(--pill-bg);font-weight:700}
    .drawer-footer{margin-top:auto;padding:12px;border-top:1px solid var(--card-border);display:flex;gap:8px}
    .drawer-close{margin-inline-start:auto}
    body.no-scroll{overflow:hidden;height:100vh}
    @media (min-width: 640px){.drawer{width:360px}}
  </style>

  <div class="drawer-backdrop" id="drawerBackdrop"></div>
  <aside class="drawer" id="drawer" aria-hidden="true" aria-label="Ù…Ù†Ùˆ Ø¬Ø§Ù†Ø¨ÛŒ">
    <div class="drawer-header">
      <div class="icon">ğŸ“‹</div>
      <div class="title">Ù…Ù†Ùˆ</div>
      <button type="button" class="menu-btn drawer-close" id="drawerCloseBtn" aria-label="Ø¨Ø³ØªÙ†">âœ•</button>
    </div>
    <nav class="drawer-nav" role="navigation">
      <a href="{{ url_for('panel_bp.panel_index') }}"{% if request.path == url_for('panel_bp.panel_index') %} aria-current="page"{% endif %}>ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
      <a href="{{ url_for('panel_bp.deposits_page') }}"{% if request.path == url_for('panel_bp.deposits_page') %} aria-current="page"{% endif %}>ğŸ’° ÙˆØ§Ø±ÛŒØ²ÛŒ</a>
      <a href="{{ url_for('panel_bp.withdrawals_page') }}"{% if request.path == url_for('panel_bp.withdrawals_page') %} aria-current="page"{% endif %}>ğŸ’¸ Ø¨Ø±Ø¯Ø§Ø´Øª</a>
      <a href="{{ url_for('panel_bp.balance_page') }}"{% if request.path == url_for('panel_bp.balance_page') %} aria-current="page"{% endif %}>ğŸ’ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</a>
      <a href="{{ url_for('panel_bp.purchases_page') }}"{% if request.path == url_for('panel_bp.purchases_page') %} aria-current="page"{% endif %}>ğŸ“Š Ø®Ø±ÛŒØ¯Ù‡Ø§</a>
      <a href="{{ url_for('panel_bp.settings_page') }}"{% if request.path == url_for('panel_bp.settings_page') %} aria-current="page"{% endif %}>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</a>
    </nav>
  </aside>

  <script>
    (function(){
      var menuBtn = document.getElementById('menuBtn');
      var drawer = document.getElementById('drawer');
      var backdrop = document.getElementById('drawerBackdrop');
      var closeBtn = document.getElementById('drawerCloseBtn');

      function closeDrawer(){
        if (drawer) drawer.classList.remove('open');
        if (backdrop) backdrop.classList.remove('open');
        if (menuBtn) menuBtn.setAttribute('aria-expanded','false');
        document.body.classList.remove('no-scroll');
        if (drawer) drawer.setAttribute('aria-hidden','true');
      }
      function openDrawer(){
        if (drawer) drawer.classList.add('open');
        if (backdrop) backdrop.classList.add('open');
        if (menuBtn) menuBtn.setAttribute('aria-expanded','true');
        document.body.classList.add('no-scroll');
        if (drawer) drawer.setAttribute('aria-hidden','false');
      }

      if (menuBtn && drawer && backdrop){
        menuBtn.addEventListener('click', function(e){
          e.stopPropagation();
          if (drawer.classList.contains('open')) closeDrawer(); else openDrawer();
        });
        backdrop.addEventListener('click', closeDrawer);
        if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
        drawer.querySelectorAll('a').forEach(function(a){ a.addEventListener('click', closeDrawer); });
        document.addEventListener('keydown', function(e){ if (e.key === 'Escape') closeDrawer(); });
      }
    })();
  </script>
{% endmacro %}
